default_platform(:ios)

platform :ios do
  desc "Build the iOS app"
  lane :build do
    api_key = app_store_connect_api_key(
      key_id: "7JM7RPTSS3",
      issuer_id: "0ed2310f-92fd-44a3-87af-35e9263850b2",
      key_filepath: "api_key.p8"
    )

    # Synchronize signing certificates and profiles using match
    match(
      type: "appstore", # Change to "development" or "adhoc" if needed
    )

    # Build the app using gym
    gym(
      scheme: "myapp", # Scheme name
      workspace: "myapp-ios/myapp.xcodeproj/project.xcworkspace", # Workspace path
      configuration: "Release", # Use "Debug" for development builds
      export_method: "app-store", # Use "ad-hoc" or "development" if needed
      export_team_id: "MNGTD992QD", # Team ID for signing
      output_directory: "myapp-ios/build", # Output directory for the IPA
      output_name: "myapp.ipa", # Output file name
      xcargs: "DEVELOPMENT_TEAM=MNGTD992QD -allowProvisioningUpdates",
      export_options: "./ExportOptions.plist"
    )
  end
end
